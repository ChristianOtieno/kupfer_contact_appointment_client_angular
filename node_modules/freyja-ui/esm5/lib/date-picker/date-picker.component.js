import * as tslib_1 from "tslib";
import { Component, Input, ViewChild, EventEmitter, Output } from '@angular/core';
import { FormGroup } from '@angular/forms';
import { NgxMyDatePickerDirective } from 'ngx-mydatepicker';
import * as moment_ from 'moment';
import { BaseComponent } from '../../lib/shared/base.component';
var moment = moment_;
var DatePickerComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DatePickerComponent, _super);
    function DatePickerComponent() {
        var _this = _super.call(this) || this;
        // public currentOptions: DatePickerOptions;
        _this.labelText = '';
        _this.controlName = '';
        _this.inputPlaceholder = '';
        _this.errors = '';
        _this.options = {};
        _this.disabled = false;
        _this.icon = true;
        _this.border = true;
        _this.padding = true;
        _this.timePicker = false;
        _this.timeLabel = 'Time';
        _this.required = false;
        _this.dateTime = null;
        /**
         * To Apply forceful error state to input component
         */
        _this.errored = false;
        _this.timePickerToggle = true;
        _this.dateIsOpen = false;
        _this.timeFocus = false;
        _this.myOptions = {
            dateFormat: 'dd.mm.yyyy',
        };
        _this.dateChangeValue = new EventEmitter();
        _this.dateChangeEvent = new EventEmitter();
        return _this;
    }
    DatePickerComponent.prototype.ngOnInit = function () {
        this.Date = this.formGroup.value["" + this.controlName];
    };
    /**
     * called from the host click, toggles the date picker and prevents picker hiding when clicked on the header elements
     * @param evt - mouse event
     */
    DatePickerComponent.prototype.toggleCalendar = function (evt) {
        evt.stopPropagation();
        if (this.disabled) {
            return;
        }
        this.ngxdp.toggleCalendar();
        var elem = document.querySelector('ngx-my-date-picker .header');
        if (elem) {
            elem.addEventListener('click', function (event) { return event.stopPropagation(); });
        }
    };
    /**
     * @description Fires when the date field change.
     * @param event IMDateModel - structured datetime.
     */
    DatePickerComponent.prototype.onDateChanged = function (event) {
        if (event.jsdate) {
            this.Date = event.jsdate.toString();
        }
        else {
            this.Date = '';
        }
        // emit date change event to parent with true value
        this.dateChangeEvent.emit(true);
        // emit date change event to parent with event
        this.dateChangeValue.emit(event);
    };
    // clear the date of the date picker;
    DatePickerComponent.prototype.clearDate = function () {
        this.ngxdp.clearDate();
        this.timePickerToggle = true;
        this.formGroup.controls["" + this.controlName].setValue(null);
    };
    DatePickerComponent.prototype.calendarToggle = function (event) {
        this.dateIsOpen = event === 1;
    };
    Object.defineProperty(DatePickerComponent.prototype, "Date", {
        /**
         * @public Date
         * @type {string}
         * @method get
         * @description gets the date part of this.dateTime as a formatted string.
         * @returns {string} - formatted date or empty string if no this.dateTime.
         */
        get: function () {
            if (this.dateTime) {
                if (this.timePicker) {
                    this.timePickerToggle = false;
                }
                return moment(this.dateTime).format('DD.MM.YYYY');
            }
            else {
                if (this.timePicker) {
                    this.timePickerToggle = true;
                }
                return '';
            }
        },
        /**
         * @public Date
         * @type {date}
         * @method set
         * @description sets the datetime to the form.
         * @param {string} datetime - string of formatted DATE part of a datetime.
         */
        set: function (datetime) {
            if (!datetime) {
                this.dateTime = '';
                if (this.timePicker) {
                    this.timePickerToggle = true;
                }
            }
            else {
                this.dateTime = new Date(datetime);
                this.formGroup.controls["" + this.controlName].setValue(this.dateTime);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Generate classes using BEM appraoch and bind to ngClass
     */
    DatePickerComponent.prototype.generateClassList = function () {
        var _a;
        var classes = (_a = {},
            _a['fj-input--' + this.size] = this.size,
            _a['fj-input--required'] = this.required,
            _a['fj-input--error'] = this.errored,
            _a);
        return classes;
    };
    DatePickerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'fj-date-picker',
                    template: "<div class=\"fj-datepicker\" [ngClass]=\"generateClassList()\"  [formGroup]=\"formGroup\" *ngIf=\"formGroup\">\n  <label\n    [attr.for]=\"id\"\n    class=\"label--medium\"\n    *ngIf=\"label\"\n  >{{label}}</label>\n  <div class=\"fj-datepicker__container\">\n    <input\n      class=\"fj-datepicker__container__input\"\n      ngx-mydatepicker\n      #dp=\"ngx-mydatepicker\"\n      [options]=\"myOptions\"\n      [defaultMonth]=\"myDefaultMonth\"\n      (calendarToggle)=\"calendarToggle($event)\"\n      (dateChanged)=\"onDateChanged($event)\"\n      (click)=\"toggleCalendar($event)\"\n      [ngStyle]= \"customStyles\"\n      [disabled]=\"disabled\"\n      [attr.name]=\"id\"\n      [placeholder]=\"placeholder\"\n      [attr.value]=\"fileCreateDate ? fileCreateDate : Date\"\n    />\n    <fj-icon svgName=\"calendar\"\n             (click)=\"toggleCalendar($event)\"\n             *ngIf=\"!disabled\"\n             [fillColor]=\"'gray-light'\"\n             class=\"fj-datepicker__container__icon\"\n    >\n    </fj-icon>\n  </div>\n</div>\n",
                    styles: ["@font-face{font-family:open-sans;font-weight:400;src:url(/assets/fonts/OpenSans-Regular.eot?) format(\"eot\"),url(/assets/fonts/OpenSans-Regular.woff) format(\"woff\"),url(/assets/fonts/OpenSans-Regular.ttf) format(\"truetype\"),url(/assets/fonts/OpenSans-Regular.svg#open-sans) format(\"svg\")}@font-face{font-family:open-sans;font-weight:600;src:url(/assets/fonts/OpenSans-Bold.eot?) format(\"eot\"),url(/assets/fonts/OpenSans-Bold.woff) format(\"woff\"),url(/assets/fonts/OpenSans-Bold.ttf) format(\"truetype\"),url(/assets/fonts/OpenSans-Bold.svg#open-sans) format(\"svg\")}:host{cursor:pointer}.fj-datepicker__container__icon{float:left;margin-top:.75rem;margin-left:-2.1875rem}.fj-datepicker__container__input{box-sizing:border-box;border:.0625rem solid rgba(0,0,0,.15);border-radius:.25rem;color:#000;display:block;font-size:.95rem;font-weight:500;height:2.5rem;margin-top:.25em;margin-right:.3125rem;outline:0;padding:.5625rem .75rem;float:left;transition:.2s linear}.fj-datepicker__container__input:focus{border-color:#1b51a0}.fj-datepicker__container__input:hover{color:rgba(0,0,0,.6)}.fj-datepicker__container__input::-webkit-input-placeholder{color:rgba(0,0,0,.6);font-weight:100}.fj-datepicker__container__input::-ms-input-placeholder{color:rgba(0,0,0,.6);font-weight:100}.fj-datepicker__container__input::placeholder{color:rgba(0,0,0,.6);font-weight:100}.fj-datepicker__container__input::-webkit-input-placeholder:hover .fj-datepicker__container__input::-webkit-input-placeholder{color:rgba(0,0,0,.6)}.fj-datepicker__container__input::-ms-input-placeholder:hover .fj-datepicker__container__input::-ms-input-placeholder{color:rgba(0,0,0,.6)}.fj-datepicker__container__input::placeholder:hover .fj-datepicker__container__input::placeholder{color:rgba(0,0,0,.6)}.fj-datepicker__container__input:disabled{background-color:#f2f2f2;border-color:#f2f2f2;cursor:not-allowed}.fj-datepicker__container__input:disabled::-webkit-input-placeholder{color:rgba(0,0,0,.2)}.fj-datepicker__container__input:disabled::-ms-input-placeholder{color:rgba(0,0,0,.2)}.fj-datepicker__container__input:disabled::placeholder{color:rgba(0,0,0,.2)}.fj-datepicker__container__input--small{height:2rem;font-size:.875rem;padding:.5625rem .625rem}.fj-datepicker__container__input--micro{height:1.5rem;font-size:.75rem;padding:.5625rem .5rem}.fj-datepicker__container__input--error{border-color:#db0000}.fj-datepicker__container__input--required:after{content:\" *\"}label{cursor:pointer;font-size:.875rem}label.label--medium{font-size:.75rem;padding-left:.5em}label.label--disabled{color:rgba(0,0,0,.2)}.input-error{color:#db0000;font-size:.75rem;padding:.5em}.error--label{font-size:.75rem;padding-left:.5em;color:#db0000}/deep/ ngx-my-date-picker .ngxmdp{position:absolute}/deep/ ngx-my-date-picker .ngxmdp .currmonth,/deep/ ngx-my-date-picker .ngxmdp .header,/deep/ ngx-my-date-picker .ngxmdp .headerbtn,/deep/ ngx-my-date-picker .ngxmdp .headerbtncell,/deep/ ngx-my-date-picker .ngxmdp .headerlabelbtn,/deep/ ngx-my-date-picker .ngxmdp .weekdaytitle{background-color:#fff}/deep/ ngx-my-date-picker .ngxmdp .weekdaytitle{padding-top:.875rem;padding-bottom:.875rem;color:#1b51a0;font-weight:600}/deep/ ngx-my-date-picker .ngxmdp .currmonth,/deep/ ngx-my-date-picker .ngxmdp .daycell,/deep/ ngx-my-date-picker .ngxmdp .highlight{color:rgba(0,0,0,.15);font-weight:500}/deep/ ngx-my-date-picker .ngxmdp .tablesingleday:hover,/deep/ ngx-my-date-picker .ngxmdp .tablesinglemonth:hover,/deep/ ngx-my-date-picker .ngxmdp .tablesingleyear:hover{background-color:#1b51a0;border-radius:.25rem}/deep/ ngx-my-date-picker .ngxmdp .tablesingleday:hover .currmonth,/deep/ ngx-my-date-picker .ngxmdp .tablesinglemonth:hover .currmonth,/deep/ ngx-my-date-picker .ngxmdp .tablesingleyear:hover .currmonth{color:#fff}/deep/ ngx-my-date-picker .ngxmdp .selectedday .datevalue{background-color:#1b51a0!important;color:#fff}/deep/ ngx-my-date-picker .ngxmdp .selector{padding:.3125rem;left:-9.375rem;background:#fff;border-color:rgba(0,0,0,.125)}/deep/ ngx-my-date-picker .ngxmdp .selector:focus{border-color:rgba(0,0,0,.125);box-shadow:0 2px 5px 0 rgba(0,0,0,.15)}/deep/ ngx-my-date-picker .ngxmdp .selectorarrow:focus:before{border-bottom-color:rgba(0,0,0,.125)}/deep/ ngx-my-date-picker .ngxmdp .selectorarrow:after{border-bottom-color:#fff}/deep/ ngx-my-date-picker .markcurrday,/deep/ ngx-my-date-picker markcurrmonth{text-decoration:none}"]
                }] }
    ];
    /** @nocollapse */
    DatePickerComponent.ctorParameters = function () { return []; };
    DatePickerComponent.propDecorators = {
        labelText: [{ type: Input }],
        formGroup: [{ type: Input }],
        controlName: [{ type: Input }],
        inputPlaceholder: [{ type: Input }],
        id: [{ type: Input }],
        errors: [{ type: Input }],
        options: [{ type: Input }],
        disabled: [{ type: Input }],
        icon: [{ type: Input }],
        border: [{ type: Input }],
        padding: [{ type: Input }],
        formOfOrigin: [{ type: Input }],
        timePicker: [{ type: Input }],
        timeLabel: [{ type: Input }],
        required: [{ type: Input }],
        error: [{ type: Input }],
        dateTime: [{ type: Input }],
        fileCreateDate: [{ type: Input }],
        customStyles: [{ type: Input }],
        errored: [{ type: Input }],
        ngxdp: [{ type: ViewChild, args: ['dp',] }],
        myDefaultMonth: [{ type: Input }],
        myOptions: [{ type: Input }],
        dateChangeValue: [{ type: Output }],
        dateChangeEvent: [{ type: Output }]
    };
    return DatePickerComponent;
}(BaseComponent));
export { DatePickerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vZnJleWphLXVpLyIsInNvdXJjZXMiOlsibGliL2RhdGUtcGlja2VyL2RhdGUtcGlja2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBa0Qsd0JBQXdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM1RyxPQUFPLEtBQUssT0FBTyxNQUFNLFFBQVEsQ0FBQztBQUNsQyxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0saUNBQWlDLENBQUM7QUFFOUQsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDO0FBQ3ZCO0lBS3lDLCtDQUFhO0lBNkNwRDtRQUFBLFlBQ0UsaUJBQU8sU0FDUjtRQTlDRCw0Q0FBNEM7UUFDbkMsZUFBUyxHQUFHLEVBQUUsQ0FBQztRQUVmLGlCQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLHNCQUFnQixHQUFHLEVBQUUsQ0FBQztRQUV0QixZQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ1osYUFBTyxHQUFRLEVBQUUsQ0FBQztRQUNsQixjQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLFVBQUksR0FBRyxJQUFJLENBQUM7UUFDWixZQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2QsYUFBTyxHQUFHLElBQUksQ0FBQztRQUVmLGdCQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLGVBQVMsR0FBRyxNQUFNLENBQUM7UUFDbkIsY0FBUSxHQUFHLEtBQUssQ0FBQztRQUlRLGNBQVEsR0FBUSxJQUFJLENBQUM7UUFNdkQ7O1dBRUc7UUFDTSxhQUFPLEdBQUcsS0FBSyxDQUFDO1FBSWxCLHNCQUFnQixHQUFHLElBQUksQ0FBQztRQUN4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LFFBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDckMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBRyxJQUFJLENBQUMsV0FBYSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUN4RTtRQUNILENBQUM7OztPQW5CQTtJQXFCRDs7T0FFRztJQUNJLCtDQUFpQixHQUF4Qjs7UUFDRSxJQUFNLE9BQU87WUFDWCxHQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxJQUFHLElBQUksQ0FBQyxJQUFJO1lBQ3JDLEdBQUMsb0JBQW9CLElBQUcsSUFBSSxDQUFDLFFBQVE7WUFDckMsR0FBQyxpQkFBaUIsSUFBRyxJQUFJLENBQUMsT0FBTztlQUNsQyxDQUFDO1FBQ0YsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQzs7Z0JBdkpGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsZ0JBQWdCO29CQUMxQixtaUNBQTJDOztpQkFFNUM7Ozs7OzRCQUdFLEtBQUs7NEJBQ0wsS0FBSzs4QkFDTCxLQUFLO21DQUNMLEtBQUs7cUJBQ0wsS0FBSzt5QkFDTCxLQUFLOzBCQUNMLEtBQUs7MkJBQ0wsS0FBSzt1QkFDTCxLQUFLO3lCQUNMLEtBQUs7MEJBQ0wsS0FBSzsrQkFDTCxLQUFLOzZCQUNMLEtBQUs7NEJBQ0wsS0FBSzsyQkFDTCxLQUFLO3dCQUlMLEtBQUs7MkJBQW9CLEtBQUs7aUNBQzlCLEtBQUs7K0JBSUwsS0FBSzswQkFJTCxLQUFLO3dCQUNMLFNBQVMsU0FBQyxJQUFJO2lDQU9kLEtBQUs7NEJBQ0wsS0FBSztrQ0FHTCxNQUFNO2tDQUNOLE1BQU07O0lBeUdULDBCQUFDO0NBQUEsQUF4SkQsQ0FLeUMsYUFBYSxHQW1KckQ7U0FuSlksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBWaWV3Q2hpbGQsIEV2ZW50RW1pdHRlciwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBJTXlEYXRlTW9kZWwsIElOZ3hNeURwT3B0aW9ucywgSU15RGVmYXVsdE1vbnRoLCBOZ3hNeURhdGVQaWNrZXJEaXJlY3RpdmUgfSBmcm9tICduZ3gtbXlkYXRlcGlja2VyJztcbmltcG9ydCAqIGFzIG1vbWVudF8gZnJvbSAnbW9tZW50JztcbmltcG9ydCB7QmFzZUNvbXBvbmVudH0gZnJvbSAnLi4vLi4vbGliL3NoYXJlZC9iYXNlLmNvbXBvbmVudCc7XG5cbmNvbnN0IG1vbWVudCA9IG1vbWVudF87XG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdmai1kYXRlLXBpY2tlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9kYXRlLXBpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2RhdGUtcGlja2VyLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgRGF0ZVBpY2tlckNvbXBvbmVudCBleHRlbmRzIEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAvLyBwdWJsaWMgY3VycmVudE9wdGlvbnM6IERhdGVQaWNrZXJPcHRpb25zO1xuICBASW5wdXQoKSBsYWJlbFRleHQgPSAnJztcbiAgQElucHV0KCkgZm9ybUdyb3VwOiBGb3JtR3JvdXA7XG4gIEBJbnB1dCgpIGNvbnRyb2xOYW1lID0gJyc7XG4gIEBJbnB1dCgpIGlucHV0UGxhY2Vob2xkZXIgPSAnJztcbiAgQElucHV0KCkgaWQ6IHN0cmluZztcbiAgQElucHV0KCkgZXJyb3JzID0gJyc7XG4gIEBJbnB1dCgpIG9wdGlvbnM6IGFueSA9IHt9O1xuICBASW5wdXQoKSBkaXNhYmxlZCA9IGZhbHNlO1xuICBASW5wdXQoKSBpY29uID0gdHJ1ZTtcbiAgQElucHV0KCkgYm9yZGVyID0gdHJ1ZTtcbiAgQElucHV0KCkgcGFkZGluZyA9IHRydWU7XG4gIEBJbnB1dCgpIGZvcm1PZk9yaWdpbjogc3RyaW5nO1xuICBASW5wdXQoKSB0aW1lUGlja2VyID0gZmFsc2U7XG4gIEBJbnB1dCgpIHRpbWVMYWJlbCA9ICdUaW1lJztcbiAgQElucHV0KCkgcmVxdWlyZWQgPSBmYWxzZTtcbiAgLyoqXG4gICAqIEVycm9yIE1lc3NhZ2UgdG8gYmUgZGlzcGxheWVkXG4gICAqL1xuICBASW5wdXQoKSBlcnJvcjogc3RyaW5nOyAgQElucHV0KCkgZGF0ZVRpbWU6IGFueSA9IG51bGw7XG4gIEBJbnB1dCgpIGZpbGVDcmVhdGVEYXRlOiBhbnk7XG4gIC8qKlxuICAgKiBjdXN0b20gc3R5bGVzIG9iamVjdCBmb3IgdGhlIGlucHV0XG4gICAqL1xuICBASW5wdXQoKSBjdXN0b21TdHlsZXM7XG4gIC8qKlxuICAgKiBUbyBBcHBseSBmb3JjZWZ1bCBlcnJvciBzdGF0ZSB0byBpbnB1dCBjb21wb25lbnRcbiAgICovXG4gIEBJbnB1dCgpIGVycm9yZWQgPSBmYWxzZTtcbiAgQFZpZXdDaGlsZCgnZHAnKSBuZ3hkcDogTmd4TXlEYXRlUGlja2VyRGlyZWN0aXZlO1xuXG4gIHB1YmxpYyBkYXRlOiBzdHJpbmc7XG4gIHB1YmxpYyB0aW1lUGlja2VyVG9nZ2xlID0gdHJ1ZTtcbiAgcHVibGljIGRhdGVJc09wZW4gPSBmYWxzZTtcbiAgcHVibGljIHRpbWVGb2N1cyA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpIG15RGVmYXVsdE1vbnRoOiBJTXlEZWZhdWx0TW9udGg7XG4gIEBJbnB1dCgpIG15T3B0aW9uczogSU5neE15RHBPcHRpb25zID0ge1xuICAgIGRhdGVGb3JtYXQ6ICdkZC5tbS55eXl5JyxcbiAgfTtcbiAgQE91dHB1dCgpIGRhdGVDaGFuZ2VWYWx1ZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBkYXRlQ2hhbmdlRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuRGF0ZSA9IHRoaXMuZm9ybUdyb3VwLnZhbHVlW2Ake3RoaXMuY29udHJvbE5hbWV9YF07XG4gIH1cblxuICAvKipcbiAgICogY2FsbGVkIGZyb20gdGhlIGhvc3QgY2xpY2ssIHRvZ2dsZXMgdGhlIGRhdGUgcGlja2VyIGFuZCBwcmV2ZW50cyBwaWNrZXIgaGlkaW5nIHdoZW4gY2xpY2tlZCBvbiB0aGUgaGVhZGVyIGVsZW1lbnRzXG4gICAqIEBwYXJhbSBldnQgLSBtb3VzZSBldmVudFxuICAgKi9cbiAgcHVibGljIHRvZ2dsZUNhbGVuZGFyKGV2dCkge1xuICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm5neGRwLnRvZ2dsZUNhbGVuZGFyKCk7XG4gICAgY29uc3QgZWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ25neC1teS1kYXRlLXBpY2tlciAuaGVhZGVyJyk7XG4gICAgaWYgKGVsZW0pIHtcbiAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIEZpcmVzIHdoZW4gdGhlIGRhdGUgZmllbGQgY2hhbmdlLlxuICAgKiBAcGFyYW0gZXZlbnQgSU1EYXRlTW9kZWwgLSBzdHJ1Y3R1cmVkIGRhdGV0aW1lLlxuICAgKi9cbiAgb25EYXRlQ2hhbmdlZChldmVudDogSU15RGF0ZU1vZGVsKTogdm9pZCB7XG4gICAgaWYgKGV2ZW50LmpzZGF0ZSkge1xuICAgICAgdGhpcy5EYXRlID0gZXZlbnQuanNkYXRlLnRvU3RyaW5nKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuRGF0ZSA9ICcnO1xuICAgIH1cbiAgICAvLyBlbWl0IGRhdGUgY2hhbmdlIGV2ZW50IHRvIHBhcmVudCB3aXRoIHRydWUgdmFsdWVcbiAgICB0aGlzLmRhdGVDaGFuZ2VFdmVudC5lbWl0KHRydWUpO1xuICAgIC8vIGVtaXQgZGF0ZSBjaGFuZ2UgZXZlbnQgdG8gcGFyZW50IHdpdGggZXZlbnRcbiAgICB0aGlzLmRhdGVDaGFuZ2VWYWx1ZS5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIC8vIGNsZWFyIHRoZSBkYXRlIG9mIHRoZSBkYXRlIHBpY2tlcjtcbiAgY2xlYXJEYXRlKCk6IHZvaWQge1xuICAgIHRoaXMubmd4ZHAuY2xlYXJEYXRlKCk7XG4gICAgdGhpcy50aW1lUGlja2VyVG9nZ2xlID0gdHJ1ZTtcbiAgICB0aGlzLmZvcm1Hcm91cC5jb250cm9sc1tgJHt0aGlzLmNvbnRyb2xOYW1lfWBdLnNldFZhbHVlKG51bGwpO1xuICB9XG5cbiAgY2FsZW5kYXJUb2dnbGUoZXZlbnQpIHtcbiAgICB0aGlzLmRhdGVJc09wZW4gPSBldmVudCA9PT0gMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcHVibGljIERhdGVcbiAgICogQHR5cGUge3N0cmluZ31cbiAgICogQG1ldGhvZCBnZXRcbiAgICogQGRlc2NyaXB0aW9uIGdldHMgdGhlIGRhdGUgcGFydCBvZiB0aGlzLmRhdGVUaW1lIGFzIGEgZm9ybWF0dGVkIHN0cmluZy5cbiAgICogQHJldHVybnMge3N0cmluZ30gLSBmb3JtYXR0ZWQgZGF0ZSBvciBlbXB0eSBzdHJpbmcgaWYgbm8gdGhpcy5kYXRlVGltZS5cbiAgICovXG4gIHB1YmxpYyBnZXQgRGF0ZSgpIHtcbiAgICBpZiAodGhpcy5kYXRlVGltZSkge1xuICAgICAgaWYgKHRoaXMudGltZVBpY2tlcikge1xuICAgICAgICB0aGlzLnRpbWVQaWNrZXJUb2dnbGUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtb21lbnQodGhpcy5kYXRlVGltZSkuZm9ybWF0KCdERC5NTS5ZWVlZJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLnRpbWVQaWNrZXIpIHtcbiAgICAgICAgdGhpcy50aW1lUGlja2VyVG9nZ2xlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHB1YmxpYyBEYXRlXG4gICAqIEB0eXBlIHtkYXRlfVxuICAgKiBAbWV0aG9kIHNldFxuICAgKiBAZGVzY3JpcHRpb24gc2V0cyB0aGUgZGF0ZXRpbWUgdG8gdGhlIGZvcm0uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBkYXRldGltZSAtIHN0cmluZyBvZiBmb3JtYXR0ZWQgREFURSBwYXJ0IG9mIGEgZGF0ZXRpbWUuXG4gICAqL1xuICBwdWJsaWMgc2V0IERhdGUoZGF0ZXRpbWUpIHtcbiAgICBpZiAoIWRhdGV0aW1lKSB7XG4gICAgICB0aGlzLmRhdGVUaW1lID0gJyc7XG4gICAgICBpZiAodGhpcy50aW1lUGlja2VyKSB7XG4gICAgICAgIHRoaXMudGltZVBpY2tlclRvZ2dsZSA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kYXRlVGltZSA9IG5ldyBEYXRlKGRhdGV0aW1lKTtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2Ake3RoaXMuY29udHJvbE5hbWV9YF0uc2V0VmFsdWUodGhpcy5kYXRlVGltZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGNsYXNzZXMgdXNpbmcgQkVNIGFwcHJhb2NoIGFuZCBiaW5kIHRvIG5nQ2xhc3NcbiAgICovXG4gIHB1YmxpYyBnZW5lcmF0ZUNsYXNzTGlzdCgpIHtcbiAgICBjb25zdCBjbGFzc2VzID0ge1xuICAgICAgWydmai1pbnB1dC0tJyArIHRoaXMuc2l6ZV06IHRoaXMuc2l6ZSxcbiAgICAgIFsnZmotaW5wdXQtLXJlcXVpcmVkJ106IHRoaXMucmVxdWlyZWQsXG4gICAgICBbJ2ZqLWlucHV0LS1lcnJvciddOiB0aGlzLmVycm9yZWQsXG4gICAgfTtcbiAgICByZXR1cm4gY2xhc3NlcztcbiAgfVxufVxuIl19