import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { LightBoxComponent } from '../light-box/light-box.component';
export class CardItemComponent {
    constructor(eRef) {
        this.eRef = eRef;
        /**
         * event triggered when an action is clicked
         */
        this.actionClicked = new EventEmitter();
        /**
         * event triggered when an element is edited
         */
        this.elementEdited = new EventEmitter();
        /**
         * checks if a click event is a single ou double click
         * {boolean}
         */
        this.isSingleClick = false;
        /**
         * checks wether the card item elements are in edit mode
         * {boolean}
         */
        this.isEdit = {
            title: false,
            subText: false,
            subText2: false,
            caption: false,
            link: false,
            date1: false,
            date2: false,
            dateHeader1: false,
            dateHeader2: false,
            details: false,
            description: false,
            tags: false
        };
        this.showBelowMenu = false;
        this.inputFieldStyles = { marginTop: 0, width: '100%' };
    }
    ngOnInit() {
        // init dynamic details field isEdit value to false
        if (this.options && this.options.details) {
            this.options.details.forEach((detailItem, index) => {
                this.isEdit['detailItem' + index] = false;
            });
        }
    }
    /**
     * fired when an action has been clicked
     * @param evt - click event
     * @param actionType - type of the action that has been fired
     */
    onActionClicked(evt, actionType) {
        if (evt.stopPropagation) {
            evt.stopPropagation();
        }
        else {
            actionType = evt;
        }
        this.actionClicked.emit(actionType);
    }
    /**
     * activates edit mode for one field
     * @param evt - click event
     * @param field - field to be edited
     */
    activateEditMode(evt, field) {
        this.isSingleClick = false;
        this.isEdit[field] = true;
    }
    /**
     * deactivates edit mode for all fields
     */
    deactivateEditMode() {
        this.isEdit = {
            title: false,
            subText: false,
            subText2: false,
            caption: false,
            link: false,
            date1: false,
            date2: false,
            dateHeader1: false,
            dateHeader2: false,
            details: false,
            description: false,
            tags: false
        };
    }
    /**
     * toggles expanded view on single click
     */
    toggleExpanded() {
        // deactivate any active edit mode
        this.isSingleClick = true;
        setTimeout(() => {
            if (this.isSingleClick) {
                this.deactivateEditMode();
                this.isExpanded = !this.isExpanded;
            }
        }, 250);
    }
    /**
     * a function that will be triggered when an editable input is focused and it will deactivate the edit mode for other inputs
     * @param {string} element - element  is edited
     */
    onInputFocused(element) {
        Object.keys(this.isEdit).forEach(key => {
            if (key !== element && this.isEdit[key]) {
                this.isEdit[key] = false;
            }
        });
    }
    /**
     * a function that is triggered when the card item picture is clicked and it sets the image in the lightbox component
     */
    onPictureClicked() {
        if (this.item[this.options.picture.image] && this.item[this.options.title.prop]) {
            this.lightBoxImages = [
                {
                    src: this.item[this.options.picture.image],
                    alt: this.item[this.options.title.prop]
                }
            ];
            this.lightBox.openModal(1);
        }
    }
    /**
     * a function that will be triggered when an item has been edited
     * @param {string} value - value of the edited element
     * @param {string} element - element that is edited
     * @param {number} index of the element in case of dynamic fields like details blocks
     */
    onEditElement(value, element, index) {
        this.isEdit[element] = false;
        const editObj = {
            element,
            value,
            index
        };
        this.elementEdited.emit(editObj);
    }
}
CardItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'fj-card-item',
                template: "<div class=\"card-item\" [ngClass]=\"{'card-item--vertical': layout === 'vertical', 'card-item--horizontal': layout === 'horizontal'}\">\n  <div class=\"card-item__content\" [ngClass]=\"{\n    'card-item__content--highlight':isHighlight,\n    'card-item__content--vertical--expanded': isExpanded && layout === 'vertical',\n    'card-item__content--horizontal--expanded': isExpanded && layout === 'horizontal',\n    'card-item__content--vertical': layout === 'vertical',\n    'card-item__content--horizontal': layout === 'horizontal'\n    }\">\n    <div class=\"card-item__header\" (click)=\"toggleExpanded()\" [ngClass]=\"{'card-item__header--vertical': layout === 'vertical', 'card-item__header--horizontal': layout === 'horizontal'}\">\n      <ng-content select=\"[card-item-header]\" ></ng-content>\n      <ng-container *ngIf=\"item\">\n        <!-- Image exists-->\n        <div class=\"card-item__picture\"\n             *ngIf=\"options?.picture && item[options?.picture?.thumbnail]\"\n             [ngStyle]=\"{'background-image': 'url(' + item[options.picture.thumbnail] + ')'}\"\n             [ngClass]=\"{'card-item__picture--vertical': layout === 'vertical', 'card-item__picture--horizontal': layout === 'horizontal'}\"\n             (click)=\"onPictureClicked()\"\n        >\n        </div>\n        <!-- No Image available-->\n        <div class=\"card-item__picture\"\n             (click)=\"file.click()\"\n             *ngIf=\"options?.picture && !item[options?.picture?.thumbnail]\"\n             [ngClass]=\"{'card-item__picture--vertical': layout === 'vertical', 'card-item__picture--horizontal': layout === 'horizontal'}\"\n        >\n          <fj-icon [svgName]=\"'upload'\"></fj-icon>\n        </div>\n        <input type=\"file\" accept=\"image/*\" hidden #file>\n        <div class=\"card-item__title__container\" *ngIf=\"options?.title || options?.subText || options?.subText2\" [ngClass]=\"{'card-item__title__container--vertical': layout === 'vertical', 'card-item__title__container--horizontal': layout === 'horizontal'}\">\n          <h3 class=\"card-item__title__heading card-item__editable\" (dblclick)=\"activateEditMode($event, 'title')\" *ngIf=\"options?.title && isEdit.title === false\">{{item[options?.title?.prop]}}</h3>\n          <fj-text-input [ngClass]=\"{'card-item__editable__input--hidden' : !isEdit.title }\"\n                         [focused]=\"isEdit.title\"\n                         (change)=\"onEditElement($event, 'title')\"\n                         [value]=\"item[options?.title?.prop]\"\n                         (focus)=\"onInputFocused('title')\"\n                         [customStyles]=\"inputFieldStyles\">\n          </fj-text-input>\n          <div class=\"card-item__title__subtext\">\n            <p *ngIf=\"options?.subText && isEdit.subText === false\" class=\"card-item__editable\" (dblclick)=\"activateEditMode($event, 'subText')\">{{item[options?.subText?.prop]}}</p>\n            <fj-text-input [ngClass]=\"{'card-item__editable__input--hidden' : !isEdit.subText }\"\n                           [focused]=\"isEdit.subText\"\n                           (focus)=\"onInputFocused('subText')\"\n                           (change)=\"onEditElement($event, 'subText')\"\n                           [value]=\"item[options?.subText?.prop]\"\n                           [customStyles]=\"inputFieldStyles\">\n\n            </fj-text-input>\n            <p *ngIf=\"options?.subText2 && isEdit.subText2 === false\" class=\"card-item__editable\" (dblclick)=\"activateEditMode($event, 'subText2')\">{{item[options?.subText2?.prop]}}</p>\n            <fj-text-input [ngClass]=\"{'card-item__editable__input--hidden' : !isEdit.subText2}\"\n                           [focused]=\"isEdit.subText2\"\n                           (focus)=\"onInputFocused('subText2')\"\n                           (change)=\"onEditElement($event, 'subText2')\"\n                           [value]=\"item[options?.subText2?.prop]\"\n                           [customStyles]=\"inputFieldStyles\">\n\n            </fj-text-input>\n          </div>\n        </div>\n        <div class=\"card-item__right__container\" *ngIf=\"options?.caption || options?.link\" [ngClass]=\"{'card-item__right__container--vertical': layout === 'vertical', 'card-item__right__container--horizontal': layout === 'horizontal'}\">\n          <span class=\"card-item__right__caption card-item__editable\" *ngIf=\"options?.caption  && isEdit.caption === false\" (dblclick)=\"activateEditMode($event, 'caption')\">{{item[options?.caption?.prop]}}</span>\n          <fj-text-input [ngClass]=\"{'card-item__editable__input--hidden' : !isEdit.caption}\"\n                         [focused]=\"isEdit.caption\"\n                         (change)=\"onEditElement($event, 'caption')\"\n                         [value]=\"item[options?.caption?.prop]\"\n                         [customStyles]=\"inputFieldStyles\">\n          </fj-text-input>\n          <a class=\"card-item__right__link card-item__editable\" *ngIf=\"options?.link && isEdit.link === false\" (dblclick)=\"activateEditMode($event, 'link')\">{{item[options?.link?.prop]}}</a>\n          <fj-text-input [ngClass]=\"{'card-item__editable__input--hidden' : !isEdit.link}\"\n                         [focused]=\"isEdit.link\"\n                         (change)=\"onEditElement($event, 'link')\"\n                         [value]=\"item[options?.link?.prop]\"\n                         [customStyles]=\"inputFieldStyles\">\n\n          </fj-text-input>\n          <div class=\"card-item__right__date caption-text\">\n            <span *ngIf=\"options?.dateHeader1 && isEdit.dateHeader1 === false\">{{options?.dateHeader1.label}} {{item[options?.dateHeader1?.prop] | date: 'dd.MM.yyyy' }}</span>\n            <span *ngIf=\"options?.dateHeader1\"> | </span>\n            <span *ngIf=\"options?.dateHeader2 && isEdit.dateHeader2 === false\">{{options?.dateHeader2.label}} {{item[options?.dateHeader1?.prop] | date: 'dd.MM.yyyy'}}</span>\n          </div>\n        </div>\n        <div class=\"card-item__actions__container\" [ngClass]=\"{'card-item__actions__container--vertical': layout === 'vertical', 'card-item__actions__container--horizontal': layout === 'horizontal'}\"\n             *ngIf=\"options?.secondaryAction || options?.primaryAction || options?.otherActions\"\n        >\n          <fj-button class=\"card-item__actions__item\" color=\"light\" size=\"small\" *ngIf=\"options?.secondaryAction\" (click)=\"onActionClicked($event, options?.secondaryAction.value)\">{{options?.secondaryAction.label}}</fj-button>\n          <fj-button class=\"card-item__actions__item\" *ngIf=\"options?.primaryAction\" size=\"small\" (click)=\"onActionClicked($event, options?.primaryAction.value)\">{{options?.primaryAction.label}}</fj-button>\n          <fj-native-dropdown class=\"card-item__actions__item\" *ngIf=\"options?.otherActions\" size=\"small\" [options]=\"options?.otherActions\" [customStyles]=\"{'borderColor': 'rgba(27, 81, 160, 1)','width' : '40px'}\" [showDefaultOnCLick]=\"true\" (optionSelected)=\"onActionClicked($event)\"></fj-native-dropdown>\n        </div>\n      </ng-container>\n\n    </div>\n    <div *ngIf=\"isExpanded\" class=\"card-item__divider\"></div>\n    <div *ngIf=\"isExpanded\" class=\"card-item__body\" [ngClass]=\"{'card-item__body--vertical': layout === 'vertical', 'card-item__body--horizontal': layout === 'horizontal'}\">\n      <ng-container *ngIf=\"item && (options?.date1 || options?.date2 || options?.details || options?.description || options?.tags)\">\n        <div class=\"card-item__body__date caption-text\">\n          <span *ngIf=\"options?.date1 && isEdit.date1 === false\">{{options?.date1.label}} {{item[options?.date1?.prop] | date: 'dd.MM.yyyy' }}</span>\n          <!-- uncomment to add editable field for date1 -->\n          <!--<fj-text-input [ngClass]=\"{'card-item__editable__input&#45;&#45;hidden' : !isEdit.date1}\"-->\n          <!--[focused]=\"isEdit.date1\"-->\n          <!--(change)=\"onEditElement($event, 'date1')\"-->\n          <!--[value]=\"item[options?.date1?.prop]\"-->\n          <!--[customStyles]=\"inputFieldStyles\">-->\n\n          <!--</fj-text-input>-->\n          <span *ngIf=\"options?.date1\"> | </span>\n          <span *ngIf=\"options?.date2 && isEdit.date2 === false\">{{options?.date2.label}} {{item[options?.date1?.prop] | date: 'dd.MM.yyyy'}}</span>\n          <!-- uncomment to add editable field for date2 -->\n          <!--<fj-text-input [ngClass]=\"{'card-item__editable__input&#45;&#45;hidden' : !isEdit.date2}\"-->\n          <!--[focused]=\"isEdit.date2\"-->\n          <!--(change)=\"onEditElement($event, 'date2')\"-->\n          <!--[value]=\"item[options?.date1?.prop]\"-->\n          <!--[customStyles]=\"inputFieldStyles\">-->\n\n          <!--</fj-text-input>-->\n        </div>\n        <div class=\"card-item__body__details\" *ngIf=\"options?.details\">\n          <ng-container *ngFor=\"let detailItem of options?.details; let i = index\">\n            <div class=\"card-item__body__details__item\">\n              <div class=\"caption-text\">\n                {{detailItem.label}}\n              </div>\n              <div class=\"card-item__editable card-item__editable--no-padding\" *ngIf=\"detailItem && isEdit['detailItem'+ i] === false\" (dblclick)=\"activateEditMode($event, 'detailItem'+i)\">\n                {{item[detailItem?.prop]}}\n              </div>\n              <fj-text-input [ngClass]=\"{'card-item__editable__input--hidden' : !isEdit['detailItem'+ i]}\"\n                             [focused]=\"isEdit['detailItem'+ i]\"\n                             (focus)=\"onInputFocused('detailItem'+ i)\"\n                             (change)=\"onEditElement($event, 'details', i)\"\n                             [value]=\"item[detailItem?.prop]\"\n                             [customStyles]=\"inputFieldStyles\">\n\n              </fj-text-input>\n            </div>\n          </ng-container>\n        </div>\n        <div class=\"card-item__body__description\">\n          <div class=\"caption-text\">\n            {{options?.description.label}}\n          </div>\n          <div  class=\"card-item__editable card-item__editable--no-padding\" *ngIf=\"options?.description && isEdit.description === false\" (dblclick)=\"activateEditMode($event, 'description')\">\n            {{item[options?.description?.prop]}}\n          </div>\n          <fj-text-input [ngClass]=\"{'card-item__editable__input--hidden' : !isEdit.description}\"\n                         [focused]=\"isEdit.description\"\n                         (focus)=\"onInputFocused('description')\"\n                         (change)=\"onEditElement($event, 'description')\"\n                         [value]=\"item[options?.description?.prop]\"\n                         [customStyles]=\"inputFieldStyles\">\n\n          </fj-text-input>\n        </div>\n        <div class=\"card-item__body__tags\" *ngIf=\"options?.tags && isEdit.tags === false\" (dblclick)=\"activateEditMode($event, 'tags')\">\n          <div class=\"caption-text\">\n            {{options?.tags.label}}\n          </div>\n          <div class=\"card-item__body__tags__text card-item__editable card-item__editable--no-padding\" *ngIf=\"options?.tags && isEdit.tags === false\" (dblclick)=\"activateEditMode($event, 'tags')\">\n            {{item[options?.tags.prop]}}\n          </div>\n          <fj-text-input [ngClass]=\"{'card-item__editable__input--hidden' : !isEdit.tags}\"\n                         [focused]=\"isEdit.tags\"\n                         (focus)=\"onInputFocused('tags')\"\n                         (change)=\"onEditElement($event, 'tags')\"\n                         [value]=\"item[options?.tags?.prop]\"\n                         [customStyles]=\"inputFieldStyles\">\n\n          </fj-text-input>\n        </div>\n      </ng-container>\n\n      <!-- custom card content-->\n      <ng-content select=\"[card-item-body]\"></ng-content>\n    </div>\n  </div>\n  <div class=\"card-item__below-menu\" *ngIf=\"options?.belowMenuPrimaryAction || options?.belowMenuOtherActions\" (click)=\"toggleExpanded()\" [ngClass]=\"{'card-item__below-menu--vertical': layout === 'vertical', 'card-item__below-menu--horizontal': layout === 'horizontal'}\" (mouseenter)=\"showBelowMenu = true\" (mouseleave)=\"showBelowMenu = false\">\n    <fj-button\n      (click)=\"onActionClicked($event, options?.belowMenuPrimaryAction.value)\"\n      *ngIf=\"showBelowMenu && options?.belowMenuPrimaryAction\"\n      [margin]=\"'15px'\"\n      [iconPosition]=\"'before'\"\n      [icon]=\"'plus'\"\n      size=\"small\"\n    >\n      {{options?.belowMenuPrimaryAction.label}}\n    </fj-button>\n    <fj-native-dropdown *ngIf=\"showBelowMenu && options?.belowMenuOtherActions\" [options]=\"options?.belowMenuOtherActions\" [customStyles]=\"{'borderColor': 'rgba(27, 81, 160, 1)','width' : '50px'}\" [showDefaultOnCLick]=\"true\" (optionSelected)=\"onActionClicked($event)\"></fj-native-dropdown>\n  </div>\n</div>\n\n<fj-light-box #lightBox [slides]=\"lightBoxImages\"></fj-light-box>\n",
                styles: ["@charset \"UTF-8\";@font-face{font-family:open-sans;font-weight:400;src:url(/assets/fonts/OpenSans-Regular.eot?) format(\"eot\"),url(/assets/fonts/OpenSans-Regular.woff) format(\"woff\"),url(/assets/fonts/OpenSans-Regular.ttf) format(\"truetype\"),url(/assets/fonts/OpenSans-Regular.svg#open-sans) format(\"svg\")}@font-face{font-family:open-sans;font-weight:600;src:url(/assets/fonts/OpenSans-Bold.eot?) format(\"eot\"),url(/assets/fonts/OpenSans-Bold.woff) format(\"woff\"),url(/assets/fonts/OpenSans-Bold.ttf) format(\"truetype\"),url(/assets/fonts/OpenSans-Bold.svg#open-sans) format(\"svg\")}.card-item{width:100%;background-color:transparent}.card-item--vertical{display:flex;margin-bottom:3.75rem;flex-direction:row}.card-item__content{box-shadow:0 .125rem .1875rem 0 rgba(0,0,0,.12);background-color:#fff}.card-item__content--vertical{flex-direction:column;width:15.625rem}.card-item__content--vertical--expanded{width:70vw}.card-item__content--horizontal{flex-direction:row}.card-item__content--highlight{background-color:#f2f2f2}.card-item__header{display:flex;cursor:pointer}.card-item__header--vertical{padding:0 .9375rem .9375rem;display:flex;flex-direction:column}.card-item__header--horizontal{padding:.9375rem;display:flex;flex-direction:row}.card-item__body{padding:.3125rem .3125rem .3125rem .9375rem;display:flex;flex-direction:column}.card-item__body__date{margin-bottom:.9375rem}.card-item__body__details{display:flex;margin-bottom:.9375rem}.card-item__body__details__item{flex:1}.card-item__body__description,.card-item__body__tags{margin-bottom:.9375rem}.card-item__body__tags__text{color:#1b51a0}.card-item__divider{height:.125rem;background-color:#f2f2f2}.card-item__below-menu{position:relative;display:flex;align-items:center;justify-content:center;height:.9375rem;width:auto;z-index:2;cursor:pointer}.card-item__below-menu--vertical{height:unset;width:.9375rem;display:flex;flex-direction:column}.card-item__below-menu:hover{background-color:#ebf2fc}.card-item__picture{display:flex;align-items:center;justify-content:center;background-color:#dce8f9;background-size:cover;background-position-x:50%;background-position-y:50%}.card-item__picture--vertical{height:13.75rem;margin:0 -.9375rem .9375rem}.card-item__picture--horizontal{width:6.25rem;height:6.25rem;margin-right:.9375rem}.card-item__picture:hover{opacity:.7}.card-item__title__container{flex:3}.card-item__title__container--vertical{max-width:18.75rem}.card-item__title__container--horizontal{max-height:6.25rem;margin-right:1.875rem}.card-item__title__heading{cursor:pointer;margin-top:0}.card-item__title__subtext>p{cursor:pointer}.card-item__right__container{flex:1;margin-right:1.875rem;display:flex;flex-direction:column}.card-item__right__container--vertical{min-height:0;margin-bottom:1.875rem}.card-item__right__container--horizontal{min-height:6.25rem}.card-item__right__caption{font-size:16px;color:#666}.card-item__right__link{font-size:16px;cursor:pointer;text-decoration:none;color:#1b51a0}.card-item__right__date{padding:.3125rem}.card-item__actions__container{display:flex;align-items:center;flex-wrap:wrap;flex-direction:row}.card-item__actions__item{margin-right:.3125rem;margin-bottom:.3125rem}.card-item__editable{cursor:pointer;margin:0;padding:.3125rem}.card-item__editable:hover:after{content:\"\u270E\";display:inline-block;padding-right:5px;font-size:13px;color:#000;font-weight:900;-webkit-transform:scale(-1,1);transform:scale(-1,1)}.card-item__editable--no-padding{padding:0}.card-item__editable__input--hidden{display:none}.caption-text{color:#666;font-size:.625rem}"]
            }] }
];
/** @nocollapse */
CardItemComponent.ctorParameters = () => [
    { type: ElementRef }
];
CardItemComponent.propDecorators = {
    item: [{ type: Input }],
    options: [{ type: Input }],
    layout: [{ type: Input }],
    isHighlight: [{ type: Input }],
    actionClicked: [{ type: Output }],
    elementEdited: [{ type: Output }],
    lightBox: [{ type: ViewChild, args: [LightBoxComponent,] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyZC1pdGVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2ZyZXlqYS11aS8iLCJzb3VyY2VzIjpbImxpYi9jYXJkLWl0ZW0vY2FyZC1pdGVtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdEcsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFPckUsTUFBTSxPQUFPLGlCQUFpQjtJQWtFNUIsWUFBb0IsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQWhEcEM7O1dBRUc7UUFDTyxrQkFBYSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2hFOztXQUVHO1FBQ08sa0JBQWEsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQVdoRTs7O1dBR0c7UUFDSSxrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUM3Qjs7O1dBR0c7UUFDSSxXQUFNLEdBQUc7WUFDZCxLQUFLLEVBQUUsS0FBSztZQUNaLE9BQU8sRUFBRSxLQUFLO1lBQ2QsUUFBUSxFQUFFLEtBQUs7WUFDZixPQUFPLEVBQUUsS0FBSztZQUNkLElBQUksRUFBRSxLQUFLO1lBQ1gsS0FBSyxFQUFFLEtBQUs7WUFDWixLQUFLLEVBQUUsS0FBSztZQUNaLFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFdBQVcsRUFBRSxLQUFLO1lBQ2xCLE9BQU8sRUFBRSxLQUFLO1lBQ2QsV0FBVyxFQUFFLEtBQUs7WUFDbEIsSUFBSSxFQUFFLEtBQUs7U0FDWixDQUFDO1FBRUssa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFFdEIscUJBQWdCLEdBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQztJQUlwQixDQUFDO0lBQ3hDLFFBQVE7UUFDTixtREFBbUQ7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LFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUI7SUFDSCxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSSxhQUFhLENBQUMsS0FBYSxFQUFFLE9BQWUsRUFBRSxLQUFjO1FBQ2pFLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDO1FBQzdCLE1BQU0sT0FBTyxHQUFHO1lBQ2QsT0FBTztZQUNQLEtBQUs7WUFDTCxLQUFLO1NBQ04sQ0FBQztRQUNGLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ25DLENBQUM7OztZQXJMRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLGl6WkFBeUM7O2FBRTFDOzs7O1lBUm1CLFVBQVU7OzttQkFjM0IsS0FBSztzQkFJTCxLQUFLO3FCQUlMLEtBQUs7MEJBSUwsS0FBSzs0QkFJTCxNQUFNOzRCQUlOLE1BQU07dUJBRU4sU0FBUyxTQUFDLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ2FyZEl0ZW1PcHRpb25zIH0gZnJvbSAnLi9jYXJkLWl0ZW0tb3B0aW9ucyc7XG5pbXBvcnQgeyBMaWdodEJveENvbXBvbmVudCB9IGZyb20gJy4uL2xpZ2h0LWJveC9saWdodC1ib3guY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZmotY2FyZC1pdGVtJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NhcmQtaXRlbS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NhcmQtaXRlbS5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIENhcmRJdGVtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAvKipcbiAgICogY3VycmVudCBpdGVtIGRhdGFcbiAgICovXG4gIEBJbnB1dCgpIGl0ZW06IGFueTtcbiAgLyoqXG4gICAqIGN1cnJlbnQgaXRlbSBvcHRpb25zXG4gICAqL1xuICBASW5wdXQoKSBvcHRpb25zOiBDYXJkSXRlbU9wdGlvbnM7XG4gIC8qKlxuICAgKiBjYXJkIGxheW91dCAodmVydGljYWwgb3IgaG9yaXpvbnRhbClcbiAgICovXG4gIEBJbnB1dCgpIGxheW91dDogJ3ZlcnRpY2FsJyB8ICdob3Jpem9udGFsJztcbiAgLyoqXG4gICAqIGlmIHRoZSBjYXJkIGlzIGhpZ2hsaWdodCBjYXJkXG4gICAqL1xuICBASW5wdXQoKSBpc0hpZ2hsaWdodDogZmFsc2U7XG4gIC8qKlxuICAgKiBldmVudCB0cmlnZ2VyZWQgd2hlbiBhbiBhY3Rpb24gaXMgY2xpY2tlZFxuICAgKi9cbiAgQE91dHB1dCgpIGFjdGlvbkNsaWNrZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAvKipcbiAgICogZXZlbnQgdHJpZ2dlcmVkIHdoZW4gYW4gZWxlbWVudCBpcyBlZGl0ZWRcbiAgICovXG4gIEBPdXRwdXQoKSBlbGVtZW50RWRpdGVkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBAVmlld0NoaWxkKExpZ2h0Qm94Q29tcG9uZW50KSBsaWdodEJveDogTGlnaHRCb3hDb21wb25lbnQ7XG5cblxuICAvKipcbiAgICogY2hlY2tzIHdldGhlciB0aGUgY2FyZCBpdGVtIGlzIGV4cGFuZGVkXG4gICAqIHtib29sZWFufVxuICAgKi9cbiAgcHVibGljIGlzRXhwYW5kZWQ7XG5cbiAgLyoqXG4gICAqIGNoZWNrcyBpZiBhIGNsaWNrIGV2ZW50IGlzIGEgc2luZ2xlIG91IGRvdWJsZSBjbGlja1xuICAgKiB7Ym9vbGVhbn1cbiAgICovXG4gIHB1YmxpYyBpc1NpbmdsZUNsaWNrID0gZmFsc2U7XG4gIC8qKlxuICAgKiBjaGVja3Mgd2V0aGVyIHRoZSBjYXJkIGl0ZW0gZWxlbWVudHMgYXJlIGluIGVkaXQgbW9kZVxuICAgKiB7Ym9vbGVhbn1cbiAgICovXG4gIHB1YmxpYyBpc0VkaXQgPSB7XG4gICAgdGl0bGU6IGZhbHNlLFxuICAgIHN1YlRleHQ6IGZhbHNlLFxuICAgIHN1YlRleHQyOiBmYWxzZSxcbiAgICBjYXB0aW9uOiBmYWxzZSxcbiAgICBsaW5rOiBmYWxzZSxcbiAgICBkYXRlMTogZmFsc2UsXG4gICAgZGF0ZTI6IGZhbHNlLFxuICAgIGRhdGVIZWFkZXIxOiBmYWxzZSxcbiAgICBkYXRlSGVhZGVyMjogZmFsc2UsXG4gICAgZGV0YWlsczogZmFsc2UsXG4gICAgZGVzY3JpcHRpb246IGZhbHNlLFxuICAgIHRhZ3M6IGZhbHNlXG4gIH07XG5cbiAgcHVibGljIHNob3dCZWxvd01lbnUgPSBmYWxzZTtcblxuICBwdWJsaWMgaW5wdXRGaWVsZFN0eWxlcyAgPSB7IG1hcmdpblRvcDogMCwgd2lkdGg6ICcxMDAlJyB9O1xuXG4gIHB1YmxpYyBsaWdodEJveEltYWdlcztcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVSZWY6IEVsZW1lbnRSZWYpIHt9XG4gIG5nT25Jbml0KCkge1xuICAgIC8vIGluaXQgZHluYW1pYyBkZXRhaWxzIGZpZWxkIGlzRWRpdCB2YWx1ZSB0byBmYWxzZVxuICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmRldGFpbHMpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5kZXRhaWxzLmZvckVhY2goIChkZXRhaWxJdGVtLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgIHRoaXMuaXNFZGl0WydkZXRhaWxJdGVtJyArIGluZGV4XSA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZpcmVkIHdoZW4gYW4gYWN0aW9uIGhhcyBiZWVuIGNsaWNrZWRcbiAgICogQHBhcmFtIGV2dCAtIGNsaWNrIGV2ZW50XG4gICAqIEBwYXJhbSBhY3Rpb25UeXBlIC0gdHlwZSBvZiB0aGUgYWN0aW9uIHRoYXQgaGFzIGJlZW4gZmlyZWRcbiAgICovXG4gIHB1YmxpYyBvbkFjdGlvbkNsaWNrZWQoZXZ0LCBhY3Rpb25UeXBlPzogc3RyaW5nKSB7XG4gICAgaWYgKGV2dC5zdG9wUHJvcGFnYXRpb24pIHtcbiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWN0aW9uVHlwZSA9IGV2dDtcbiAgICB9XG4gICAgdGhpcy5hY3Rpb25DbGlja2VkLmVtaXQoYWN0aW9uVHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogYWN0aXZhdGVzIGVkaXQgbW9kZSBmb3Igb25lIGZpZWxkXG4gICAqIEBwYXJhbSBldnQgLSBjbGljayBldmVudFxuICAgKiBAcGFyYW0gZmllbGQgLSBmaWVsZCB0byBiZSBlZGl0ZWRcbiAgICovXG4gIHB1YmxpYyBhY3RpdmF0ZUVkaXRNb2RlKGV2dCwgZmllbGQpIHtcbiAgICB0aGlzLmlzU2luZ2xlQ2xpY2sgPSBmYWxzZTtcbiAgICB0aGlzLmlzRWRpdFtmaWVsZF0gPSB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIGRlYWN0aXZhdGVzIGVkaXQgbW9kZSBmb3IgYWxsIGZpZWxkc1xuICAgKi9cbiAgcHVibGljIGRlYWN0aXZhdGVFZGl0TW9kZSgpIHtcbiAgICB0aGlzLmlzRWRpdCA9IHtcbiAgICAgIHRpdGxlOiBmYWxzZSxcbiAgICAgIHN1YlRleHQ6IGZhbHNlLFxuICAgICAgc3ViVGV4dDI6IGZhbHNlLFxuICAgICAgY2FwdGlvbjogZmFsc2UsXG4gICAgICBsaW5rOiBmYWxzZSxcbiAgICAgIGRhdGUxOiBmYWxzZSxcbiAgICAgIGRhdGUyOiBmYWxzZSxcbiAgICAgIGRhdGVIZWFkZXIxOiBmYWxzZSxcbiAgICAgIGRhdGVIZWFkZXIyOiBmYWxzZSxcbiAgICAgIGRldGFpbHM6IGZhbHNlLFxuICAgICAgZGVzY3JpcHRpb246IGZhbHNlLFxuICAgICAgdGFnczogZmFsc2VcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIHRvZ2dsZXMgZXhwYW5kZWQgdmlldyBvbiBzaW5nbGUgY2xpY2tcbiAgICovXG4gIHB1YmxpYyB0b2dnbGVFeHBhbmRlZCgpIHtcbiAgICAvLyBkZWFjdGl2YXRlIGFueSBhY3RpdmUgZWRpdCBtb2RlXG4gICAgdGhpcy5pc1NpbmdsZUNsaWNrID0gdHJ1ZTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmlzU2luZ2xlQ2xpY2spIHtcbiAgICAgICAgdGhpcy5kZWFjdGl2YXRlRWRpdE1vZGUoKTtcbiAgICAgICAgdGhpcy5pc0V4cGFuZGVkID0gIXRoaXMuaXNFeHBhbmRlZDtcbiAgICAgIH1cbiAgICB9LCAyNTApO1xuXG4gIH1cblxuICAvKipcbiAgICogYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgdHJpZ2dlcmVkIHdoZW4gYW4gZWRpdGFibGUgaW5wdXQgaXMgZm9jdXNlZCBhbmQgaXQgd2lsbCBkZWFjdGl2YXRlIHRoZSBlZGl0IG1vZGUgZm9yIG90aGVyIGlucHV0c1xuICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudCAtIGVsZW1lbnQgIGlzIGVkaXRlZFxuICAgKi9cbiAgcHVibGljIG9uSW5wdXRGb2N1c2VkKGVsZW1lbnQ6IHN0cmluZykge1xuICAgIE9iamVjdC5rZXlzKHRoaXMuaXNFZGl0KS5mb3JFYWNoKCBrZXkgPT4ge1xuICAgICAgaWYgKGtleSAhPT0gZWxlbWVudCAmJiB0aGlzLmlzRWRpdFtrZXldKSB7XG4gICAgICAgIHRoaXMuaXNFZGl0W2tleV0gPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBhIGZ1bmN0aW9uIHRoYXQgaXMgdHJpZ2dlcmVkIHdoZW4gdGhlIGNhcmQgaXRlbSBwaWN0dXJlIGlzIGNsaWNrZWQgYW5kIGl0IHNldHMgdGhlIGltYWdlIGluIHRoZSBsaWdodGJveCBjb21wb25lbnRcbiAgICovXG4gIHB1YmxpYyBvblBpY3R1cmVDbGlja2VkKCkge1xuICAgIGlmICh0aGlzLml0ZW1bdGhpcy5vcHRpb25zLnBpY3R1cmUuaW1hZ2VdICYmIHRoaXMuaXRlbVt0aGlzLm9wdGlvbnMudGl0bGUucHJvcF0pIHtcbiAgICAgIHRoaXMubGlnaHRCb3hJbWFnZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBzcmM6IHRoaXMuaXRlbVt0aGlzLm9wdGlvbnMucGljdHVyZS5pbWFnZV0sXG4gICAgICAgICAgYWx0OiB0aGlzLml0ZW1bdGhpcy5vcHRpb25zLnRpdGxlLnByb3BdXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICB0aGlzLmxpZ2h0Qm94Lm9wZW5Nb2RhbCgxKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgdHJpZ2dlcmVkIHdoZW4gYW4gaXRlbSBoYXMgYmVlbiBlZGl0ZWRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gdmFsdWUgb2YgdGhlIGVkaXRlZCBlbGVtZW50XG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50IC0gZWxlbWVudCB0aGF0IGlzIGVkaXRlZFxuICAgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggb2YgdGhlIGVsZW1lbnQgaW4gY2FzZSBvZiBkeW5hbWljIGZpZWxkcyBsaWtlIGRldGFpbHMgYmxvY2tzXG4gICAqL1xuICBwdWJsaWMgb25FZGl0RWxlbWVudCh2YWx1ZTogc3RyaW5nLCBlbGVtZW50OiBzdHJpbmcsIGluZGV4PzogbnVtYmVyKSB7XG4gICAgdGhpcy5pc0VkaXRbZWxlbWVudF0gPSBmYWxzZTtcbiAgICBjb25zdCBlZGl0T2JqID0ge1xuICAgICAgZWxlbWVudCxcbiAgICAgIHZhbHVlLFxuICAgICAgaW5kZXhcbiAgICB9O1xuICAgIHRoaXMuZWxlbWVudEVkaXRlZC5lbWl0KGVkaXRPYmopO1xuICB9XG59XG4iXX0=