import { Component, Input, ViewChild, EventEmitter, Output } from '@angular/core';
import { FormGroup } from '@angular/forms';
import { NgxMyDatePickerDirective } from 'ngx-mydatepicker';
import * as moment_ from 'moment';
import { BaseComponent } from '../../lib/shared/base.component';
const moment = moment_;
export class DatePickerComponent extends BaseComponent {
    constructor() {
        super();
        // public currentOptions: DatePickerOptions;
        this.labelText = '';
        this.controlName = '';
        this.inputPlaceholder = '';
        this.errors = '';
        this.options = {};
        this.disabled = false;
        this.icon = true;
        this.border = true;
        this.padding = true;
        this.timePicker = false;
        this.timeLabel = 'Time';
        this.required = false;
        this.dateTime = null;
        /**
         * To Apply forceful error state to input component
         */
        this.errored = false;
        this.timePickerToggle = true;
        this.dateIsOpen = false;
        this.timeFocus = false;
        this.myOptions = {
            dateFormat: 'dd.mm.yyyy',
        };
        this.dateChangeValue = new EventEmitter();
        this.dateChangeEvent = new EventEmitter();
    }
    ngOnInit() {
        this.Date = this.formGroup.value[`${this.controlName}`];
    }
    /**
     * called from the host click, toggles the date picker and prevents picker hiding when clicked on the header elements
     * @param evt - mouse event
     */
    toggleCalendar(evt) {
        evt.stopPropagation();
        if (this.disabled) {
            return;
        }
        this.ngxdp.toggleCalendar();
        const elem = document.querySelector('ngx-my-date-picker .header');
        if (elem) {
            elem.addEventListener('click', (event) => event.stopPropagation());
        }
    }
    /**
     * @description Fires when the date field change.
     * @param event IMDateModel - structured datetime.
     */
    onDateChanged(event) {
        if (event.jsdate) {
            this.Date = event.jsdate.toString();
        }
        else {
            this.Date = '';
        }
        // emit date change event to parent with true value
        this.dateChangeEvent.emit(true);
        // emit date change event to parent with event
        this.dateChangeValue.emit(event);
    }
    // clear the date of the date picker;
    clearDate() {
        this.ngxdp.clearDate();
        this.timePickerToggle = true;
        this.formGroup.controls[`${this.controlName}`].setValue(null);
    }
    calendarToggle(event) {
        this.dateIsOpen = event === 1;
    }
    /**
     * @public Date
     * @type {string}
     * @method get
     * @description gets the date part of this.dateTime as a formatted string.
     * @returns {string} - formatted date or empty string if no this.dateTime.
     */
    get Date() {
        if (this.dateTime) {
            if (this.timePicker) {
                this.timePickerToggle = false;
            }
            return moment(this.dateTime).format('DD.MM.YYYY');
        }
        else {
            if (this.timePicker) {
                this.timePickerToggle = true;
            }
            return '';
        }
    }
    /**
     * @public Date
     * @type {date}
     * @method set
     * @description sets the datetime to the form.
     * @param {string} datetime - string of formatted DATE part of a datetime.
     */
    set Date(datetime) {
        if (!datetime) {
            this.dateTime = '';
            if (this.timePicker) {
                this.timePickerToggle = true;
            }
        }
        else {
            this.dateTime = new Date(datetime);
            this.formGroup.controls[`${this.controlName}`].setValue(this.dateTime);
        }
    }
    /**
     * Generate classes using BEM appraoch and bind to ngClass
     */
    generateClassList() {
        const classes = {
            ['fj-input--' + this.size]: this.size,
            ['fj-input--required']: this.required,
            ['fj-input--error']: this.errored,
        };
        return classes;
    }
}
DatePickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'fj-date-picker',
                template: "<div class=\"fj-datepicker\" [ngClass]=\"generateClassList()\"  [formGroup]=\"formGroup\" *ngIf=\"formGroup\">\n  <label\n    [attr.for]=\"id\"\n    class=\"label--medium\"\n    *ngIf=\"label\"\n  >{{label}}</label>\n  <div class=\"fj-datepicker__container\">\n    <input\n      class=\"fj-datepicker__container__input\"\n      ngx-mydatepicker\n      #dp=\"ngx-mydatepicker\"\n      [options]=\"myOptions\"\n      [defaultMonth]=\"myDefaultMonth\"\n      (calendarToggle)=\"calendarToggle($event)\"\n      (dateChanged)=\"onDateChanged($event)\"\n      (click)=\"toggleCalendar($event)\"\n      [ngStyle]= \"customStyles\"\n      [disabled]=\"disabled\"\n      [attr.name]=\"id\"\n      [placeholder]=\"placeholder\"\n      [attr.value]=\"fileCreateDate ? fileCreateDate : Date\"\n    />\n    <fj-icon svgName=\"calendar\"\n             (click)=\"toggleCalendar($event)\"\n             *ngIf=\"!disabled\"\n             [fillColor]=\"'gray-light'\"\n             class=\"fj-datepicker__container__icon\"\n    >\n    </fj-icon>\n  </div>\n</div>\n",
                styles: ["@font-face{font-family:open-sans;font-weight:400;src:url(/assets/fonts/OpenSans-Regular.eot?) format(\"eot\"),url(/assets/fonts/OpenSans-Regular.woff) format(\"woff\"),url(/assets/fonts/OpenSans-Regular.ttf) format(\"truetype\"),url(/assets/fonts/OpenSans-Regular.svg#open-sans) format(\"svg\")}@font-face{font-family:open-sans;font-weight:600;src:url(/assets/fonts/OpenSans-Bold.eot?) format(\"eot\"),url(/assets/fonts/OpenSans-Bold.woff) format(\"woff\"),url(/assets/fonts/OpenSans-Bold.ttf) format(\"truetype\"),url(/assets/fonts/OpenSans-Bold.svg#open-sans) format(\"svg\")}:host{cursor:pointer}.fj-datepicker__container__icon{float:left;margin-top:.75rem;margin-left:-2.1875rem}.fj-datepicker__container__input{box-sizing:border-box;border:.0625rem solid rgba(0,0,0,.15);border-radius:.25rem;color:#000;display:block;font-size:.95rem;font-weight:500;height:2.5rem;margin-top:.25em;margin-right:.3125rem;outline:0;padding:.5625rem .75rem;float:left;transition:.2s linear}.fj-datepicker__container__input:focus{border-color:#1b51a0}.fj-datepicker__container__input:hover{color:rgba(0,0,0,.6)}.fj-datepicker__container__input::-webkit-input-placeholder{color:rgba(0,0,0,.6);font-weight:100}.fj-datepicker__container__input::-ms-input-placeholder{color:rgba(0,0,0,.6);font-weight:100}.fj-datepicker__container__input::placeholder{color:rgba(0,0,0,.6);font-weight:100}.fj-datepicker__container__input::-webkit-input-placeholder:hover .fj-datepicker__container__input::-webkit-input-placeholder{color:rgba(0,0,0,.6)}.fj-datepicker__container__input::-ms-input-placeholder:hover .fj-datepicker__container__input::-ms-input-placeholder{color:rgba(0,0,0,.6)}.fj-datepicker__container__input::placeholder:hover .fj-datepicker__container__input::placeholder{color:rgba(0,0,0,.6)}.fj-datepicker__container__input:disabled{background-color:#f2f2f2;border-color:#f2f2f2;cursor:not-allowed}.fj-datepicker__container__input:disabled::-webkit-input-placeholder{color:rgba(0,0,0,.2)}.fj-datepicker__container__input:disabled::-ms-input-placeholder{color:rgba(0,0,0,.2)}.fj-datepicker__container__input:disabled::placeholder{color:rgba(0,0,0,.2)}.fj-datepicker__container__input--small{height:2rem;font-size:.875rem;padding:.5625rem .625rem}.fj-datepicker__container__input--micro{height:1.5rem;font-size:.75rem;padding:.5625rem .5rem}.fj-datepicker__container__input--error{border-color:#db0000}.fj-datepicker__container__input--required:after{content:\" *\"}label{cursor:pointer;font-size:.875rem}label.label--medium{font-size:.75rem;padding-left:.5em}label.label--disabled{color:rgba(0,0,0,.2)}.input-error{color:#db0000;font-size:.75rem;padding:.5em}.error--label{font-size:.75rem;padding-left:.5em;color:#db0000}/deep/ ngx-my-date-picker .ngxmdp{position:absolute}/deep/ ngx-my-date-picker .ngxmdp .currmonth,/deep/ ngx-my-date-picker .ngxmdp .header,/deep/ ngx-my-date-picker .ngxmdp .headerbtn,/deep/ ngx-my-date-picker .ngxmdp .headerbtncell,/deep/ ngx-my-date-picker .ngxmdp .headerlabelbtn,/deep/ ngx-my-date-picker .ngxmdp .weekdaytitle{background-color:#fff}/deep/ ngx-my-date-picker .ngxmdp .weekdaytitle{padding-top:.875rem;padding-bottom:.875rem;color:#1b51a0;font-weight:600}/deep/ ngx-my-date-picker .ngxmdp .currmonth,/deep/ ngx-my-date-picker .ngxmdp .daycell,/deep/ ngx-my-date-picker .ngxmdp .highlight{color:rgba(0,0,0,.15);font-weight:500}/deep/ ngx-my-date-picker .ngxmdp .tablesingleday:hover,/deep/ ngx-my-date-picker .ngxmdp .tablesinglemonth:hover,/deep/ ngx-my-date-picker .ngxmdp .tablesingleyear:hover{background-color:#1b51a0;border-radius:.25rem}/deep/ ngx-my-date-picker .ngxmdp .tablesingleday:hover .currmonth,/deep/ ngx-my-date-picker .ngxmdp .tablesinglemonth:hover .currmonth,/deep/ ngx-my-date-picker .ngxmdp .tablesingleyear:hover .currmonth{color:#fff}/deep/ ngx-my-date-picker .ngxmdp .selectedday .datevalue{background-color:#1b51a0!important;color:#fff}/deep/ ngx-my-date-picker .ngxmdp .selector{padding:.3125rem;left:-9.375rem;background:#fff;border-color:rgba(0,0,0,.125)}/deep/ ngx-my-date-picker .ngxmdp .selector:focus{border-color:rgba(0,0,0,.125);box-shadow:0 2px 5px 0 rgba(0,0,0,.15)}/deep/ ngx-my-date-picker .ngxmdp .selectorarrow:focus:before{border-bottom-color:rgba(0,0,0,.125)}/deep/ ngx-my-date-picker .ngxmdp .selectorarrow:after{border-bottom-color:#fff}/deep/ ngx-my-date-picker .markcurrday,/deep/ ngx-my-date-picker markcurrmonth{text-decoration:none}"]
            }] }
];
/** @nocollapse */
DatePickerComponent.ctorParameters = () => [];
DatePickerComponent.propDecorators = {
    labelText: [{ type: Input }],
    formGroup: [{ type: Input }],
    controlName: [{ type: Input }],
    inputPlaceholder: [{ type: Input }],
    id: [{ type: Input }],
    errors: [{ type: Input }],
    options: [{ type: Input }],
    disabled: [{ type: Input }],
    icon: [{ type: Input }],
    border: [{ type: Input }],
    padding: [{ type: Input }],
    formOfOrigin: [{ type: Input }],
    timePicker: [{ type: Input }],
    timeLabel: [{ type: Input }],
    required: [{ type: Input }],
    error: [{ type: Input }],
    dateTime: [{ type: Input }],
    fileCreateDate: [{ type: Input }],
    customStyles: [{ type: Input }],
    errored: [{ type: Input }],
    ngxdp: [{ type: ViewChild, args: ['dp',] }],
    myDefaultMonth: [{ type: Input }],
    myOptions: [{ type: Input }],
    dateChangeValue: [{ type: Output }],
    dateChangeEvent: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vZnJleWphLXVpLyIsInNvdXJjZXMiOlsibGliL2RhdGUtcGlja2VyL2RhdGUtcGlja2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFrRCx3QkFBd0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzVHLE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDO0FBQ2xDLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxpQ0FBaUMsQ0FBQztBQUU5RCxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUM7QUFNdkIsTUFBTSxPQUFPLG1CQUFvQixTQUFRLGFBQWE7SUE2Q3BEO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUE3Q1YsNENBQTRDO1FBQ25DLGNBQVMsR0FBRyxFQUFFLENBQUM7UUFFZixnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUNqQixxQkFBZ0IsR0FBRyxFQUFFLENBQUM7UUFFdEIsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUNaLFlBQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqQixTQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ1osV0FBTSxHQUFHLElBQUksQ0FBQztRQUNkLFlBQU8sR0FBRyxJQUFJLENBQUM7UUFFZixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLGNBQVMsR0FBRyxNQUFNLENBQUM7UUFDbkIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUlRLGFBQVEsR0FBUSxJQUFJLENBQUM7UUFNdkQ7O1dBRUc7UUFDTSxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBSWxCLHFCQUFnQixHQUFHLElB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USxDQUFDLENBQUM7WUFDckMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3hFO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0ksaUJBQWlCO1FBQ3RCLE1BQU0sT0FBTyxHQUFHO1lBQ2QsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ3JDLENBQUMsb0JBQW9CLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUTtZQUNyQyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsSUFBSSxDQUFDLE9BQU87U0FDbEMsQ0FBQztRQUNGLE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7OztZQXZKRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjtnQkFDMUIsbWlDQUEyQzs7YUFFNUM7Ozs7O3dCQUdFLEtBQUs7d0JBQ0wsS0FBSzswQkFDTCxLQUFLOytCQUNMLEtBQUs7aUJBQ0wsS0FBSztxQkFDTCxLQUFLO3NCQUNMLEtBQUs7dUJBQ0wsS0FBSzttQkFDTCxLQUFLO3FCQUNMLEtBQUs7c0JBQ0wsS0FBSzsyQkFDTCxLQUFLO3lCQUNMLEtBQUs7d0JBQ0wsS0FBSzt1QkFDTCxLQUFLO29CQUlMLEtBQUs7dUJBQW9CLEtBQUs7NkJBQzlCLEtBQUs7MkJBSUwsS0FBSztzQkFJTCxLQUFLO29CQUNMLFNBQVMsU0FBQyxJQUFJOzZCQU9kLEtBQUs7d0JBQ0wsS0FBSzs4QkFHTCxNQUFNOzhCQUNOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIFZpZXdDaGlsZCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IElNeURhdGVNb2RlbCwgSU5neE15RHBPcHRpb25zLCBJTXlEZWZhdWx0TW9udGgsIE5neE15RGF0ZVBpY2tlckRpcmVjdGl2ZSB9IGZyb20gJ25neC1teWRhdGVwaWNrZXInO1xuaW1wb3J0ICogYXMgbW9tZW50XyBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHtCYXNlQ29tcG9uZW50fSBmcm9tICcuLi8uLi9saWIvc2hhcmVkL2Jhc2UuY29tcG9uZW50JztcblxuY29uc3QgbW9tZW50ID0gbW9tZW50XztcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2ZqLWRhdGUtcGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RhdGUtcGlja2VyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZGF0ZS1waWNrZXIuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBEYXRlUGlja2VyQ29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIC8vIHB1YmxpYyBjdXJyZW50T3B0aW9uczogRGF0ZVBpY2tlck9wdGlvbnM7XG4gIEBJbnB1dCgpIGxhYmVsVGV4dCA9ICcnO1xuICBASW5wdXQoKSBmb3JtR3JvdXA6IEZvcm1Hcm91cDtcbiAgQElucHV0KCkgY29udHJvbE5hbWUgPSAnJztcbiAgQElucHV0KCkgaW5wdXRQbGFjZWhvbGRlciA9ICcnO1xuICBASW5wdXQoKSBpZDogc3RyaW5nO1xuICBASW5wdXQoKSBlcnJvcnMgPSAnJztcbiAgQElucHV0KCkgb3B0aW9uczogYW55ID0ge307XG4gIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIGljb24gPSB0cnVlO1xuICBASW5wdXQoKSBib3JkZXIgPSB0cnVlO1xuICBASW5wdXQoKSBwYWRkaW5nID0gdHJ1ZTtcbiAgQElucHV0KCkgZm9ybU9mT3JpZ2luOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHRpbWVQaWNrZXIgPSBmYWxzZTtcbiAgQElucHV0KCkgdGltZUxhYmVsID0gJ1RpbWUnO1xuICBASW5wdXQoKSByZXF1aXJlZCA9IGZhbHNlO1xuICAvKipcbiAgICogRXJyb3IgTWVzc2FnZSB0byBiZSBkaXNwbGF5ZWRcbiAgICovXG4gIEBJbnB1dCgpIGVycm9yOiBzdHJpbmc7ICBASW5wdXQoKSBkYXRlVGltZTogYW55ID0gbnVsbDtcbiAgQElucHV0KCkgZmlsZUNyZWF0ZURhdGU6IGFueTtcbiAgLyoqXG4gICAqIGN1c3RvbSBzdHlsZXMgb2JqZWN0IGZvciB0aGUgaW5wdXRcbiAgICovXG4gIEBJbnB1dCgpIGN1c3RvbVN0eWxlcztcbiAgLyoqXG4gICAqIFRvIEFwcGx5IGZvcmNlZnVsIGVycm9yIHN0YXRlIHRvIGlucHV0IGNvbXBvbmVudFxuICAgKi9cbiAgQElucHV0KCkgZXJyb3JlZCA9IGZhbHNlO1xuICBAVmlld0NoaWxkKCdkcCcpIG5neGRwOiBOZ3hNeURhdGVQaWNrZXJEaXJlY3RpdmU7XG5cbiAgcHVibGljIGRhdGU6IHN0cmluZztcbiAgcHVibGljIHRpbWVQaWNrZXJUb2dnbGUgPSB0cnVlO1xuICBwdWJsaWMgZGF0ZUlzT3BlbiA9IGZhbHNlO1xuICBwdWJsaWMgdGltZUZvY3VzID0gZmFsc2U7XG5cbiAgQElucHV0KCkgbXlEZWZhdWx0TW9udGg6IElNeURlZmF1bHRNb250aDtcbiAgQElucHV0KCkgbXlPcHRpb25zOiBJTmd4TXlEcE9wdGlvbnMgPSB7XG4gICAgZGF0ZUZvcm1hdDogJ2RkLm1tLnl5eXknLFxuICB9O1xuICBAT3V0cHV0KCkgZGF0ZUNoYW5nZVZhbHVlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGRhdGVDaGFuZ2VFdmVudDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5EYXRlID0gdGhpcy5mb3JtR3JvdXAudmFsdWVbYCR7dGhpcy5jb250cm9sTmFtZX1gXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBjYWxsZWQgZnJvbSB0aGUgaG9zdCBjbGljaywgdG9nZ2xlcyB0aGUgZGF0ZSBwaWNrZXIgYW5kIHByZXZlbnRzIHBpY2tlciBoaWRpbmcgd2hlbiBjbGlja2VkIG9uIHRoZSBoZWFkZXIgZWxlbWVudHNcbiAgICogQHBhcmFtIGV2dCAtIG1vdXNlIGV2ZW50XG4gICAqL1xuICBwdWJsaWMgdG9nZ2xlQ2FsZW5kYXIoZXZ0KSB7XG4gICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubmd4ZHAudG9nZ2xlQ2FsZW5kYXIoKTtcbiAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignbmd4LW15LWRhdGUtcGlja2VyIC5oZWFkZXInKTtcbiAgICBpZiAoZWxlbSkge1xuICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gRmlyZXMgd2hlbiB0aGUgZGF0ZSBmaWVsZCBjaGFuZ2UuXG4gICAqIEBwYXJhbSBldmVudCBJTURhdGVNb2RlbCAtIHN0cnVjdHVyZWQgZGF0ZXRpbWUuXG4gICAqL1xuICBvbkRhdGVDaGFuZ2VkKGV2ZW50OiBJTXlEYXRlTW9kZWwpOiB2b2lkIHtcbiAgICBpZiAoZXZlbnQuanNkYXRlKSB7XG4gICAgICB0aGlzLkRhdGUgPSBldmVudC5qc2RhdGUudG9TdHJpbmcoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5EYXRlID0gJyc7XG4gICAgfVxuICAgIC8vIGVtaXQgZGF0ZSBjaGFuZ2UgZXZlbnQgdG8gcGFyZW50IHdpdGggdHJ1ZSB2YWx1ZVxuICAgIHRoaXMuZGF0ZUNoYW5nZUV2ZW50LmVtaXQodHJ1ZSk7XG4gICAgLy8gZW1pdCBkYXRlIGNoYW5nZSBldmVudCB0byBwYXJlbnQgd2l0aCBldmVudFxuICAgIHRoaXMuZGF0ZUNoYW5nZVZhbHVlLmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgLy8gY2xlYXIgdGhlIGRhdGUgb2YgdGhlIGRhdGUgcGlja2VyO1xuICBjbGVhckRhdGUoKTogdm9pZCB7XG4gICAgdGhpcy5uZ3hkcC5jbGVhckRhdGUoKTtcbiAgICB0aGlzLnRpbWVQaWNrZXJUb2dnbGUgPSB0cnVlO1xuICAgIHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2Ake3RoaXMuY29udHJvbE5hbWV9YF0uc2V0VmFsdWUobnVsbCk7XG4gIH1cblxuICBjYWxlbmRhclRvZ2dsZShldmVudCkge1xuICAgIHRoaXMuZGF0ZUlzT3BlbiA9IGV2ZW50ID09PSAxO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwdWJsaWMgRGF0ZVxuICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgKiBAbWV0aG9kIGdldFxuICAgKiBAZGVzY3JpcHRpb24gZ2V0cyB0aGUgZGF0ZSBwYXJ0IG9mIHRoaXMuZGF0ZVRpbWUgYXMgYSBmb3JtYXR0ZWQgc3RyaW5nLlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIGZvcm1hdHRlZCBkYXRlIG9yIGVtcHR5IHN0cmluZyBpZiBubyB0aGlzLmRhdGVUaW1lLlxuICAgKi9cbiAgcHVibGljIGdldCBEYXRlKCkge1xuICAgIGlmICh0aGlzLmRhdGVUaW1lKSB7XG4gICAgICBpZiAodGhpcy50aW1lUGlja2VyKSB7XG4gICAgICAgIHRoaXMudGltZVBpY2tlclRvZ2dsZSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1vbWVudCh0aGlzLmRhdGVUaW1lKS5mb3JtYXQoJ0RELk1NLllZWVknKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMudGltZVBpY2tlcikge1xuICAgICAgICB0aGlzLnRpbWVQaWNrZXJUb2dnbGUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAcHVibGljIERhdGVcbiAgICogQHR5cGUge2RhdGV9XG4gICAqIEBtZXRob2Qgc2V0XG4gICAqIEBkZXNjcmlwdGlvbiBzZXRzIHRoZSBkYXRldGltZSB0byB0aGUgZm9ybS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGV0aW1lIC0gc3RyaW5nIG9mIGZvcm1hdHRlZCBEQVRFIHBhcnQgb2YgYSBkYXRldGltZS5cbiAgICovXG4gIHB1YmxpYyBzZXQgRGF0ZShkYXRldGltZSkge1xuICAgIGlmICghZGF0ZXRpbWUpIHtcbiAgICAgIHRoaXMuZGF0ZVRpbWUgPSAnJztcbiAgICAgIGlmICh0aGlzLnRpbWVQaWNrZXIpIHtcbiAgICAgICAgdGhpcy50aW1lUGlja2VyVG9nZ2xlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRhdGVUaW1lID0gbmV3IERhdGUoZGF0ZXRpbWUpO1xuICAgICAgdGhpcy5mb3JtR3JvdXAuY29udHJvbHNbYCR7dGhpcy5jb250cm9sTmFtZX1gXS5zZXRWYWx1ZSh0aGlzLmRhdGVUaW1lKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY2xhc3NlcyB1c2luZyBCRU0gYXBwcmFvY2ggYW5kIGJpbmQgdG8gbmdDbGFzc1xuICAgKi9cbiAgcHVibGljIGdlbmVyYXRlQ2xhc3NMaXN0KCkge1xuICAgIGNvbnN0IGNsYXNzZXMgPSB7XG4gICAgICBbJ2ZqLWlucHV0LS0nICsgdGhpcy5zaXplXTogdGhpcy5zaXplLFxuICAgICAgWydmai1pbnB1dC0tcmVxdWlyZWQnXTogdGhpcy5yZXF1aXJlZCxcbiAgICAgIFsnZmotaW5wdXQtLWVycm9yJ106IHRoaXMuZXJyb3JlZCxcbiAgICB9O1xuICAgIHJldHVybiBjbGFzc2VzO1xuICB9XG59XG4iXX0=